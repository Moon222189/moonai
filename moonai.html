<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoonAI - Online Smart AI</title>
<style>
body { font-family: system-ui, sans-serif; background: #f0f4f8; margin: 20px; }
.container { max-width: 900px; margin: auto; display: flex; flex-direction: column; gap: 12px; }
h2 { text-align: center; color: #111; }
#chat { border:1px solid #ddd; padding:15px; height:600px; overflow-y:auto; background:#fff; border-radius:12px; display:flex; flex-direction:column; gap:8px; }
.bubble { max-width:80%; padding:10px 14px; border-radius:14px; cursor:pointer; white-space: pre-wrap; }
.user { align-self:flex-end; background:#007bff; color:#fff; }
.bot { align-self:flex-start; background:#e5e5ea; color:#111; }
.typing { font-style: italic; color: #666; }
.blink { animation: blink 1s steps(2, start) infinite; }
@keyframes blink { to { visibility: hidden; } }
</style>
</head>
<body>
<div class="container">
  <h2>MoonAI - Online Smart AI</h2>
  <div id="chat"></div>
  <div style="display:flex; gap:8px;">
    <input id="message" placeholder="Ask me anything..." autocomplete="off" style="flex:1; padding:10px; border-radius:8px; border:1px solid #ccc;">
    <button onclick="sendMessage()" style="padding:10px 20px; border:none; border-radius:8px; background:#007bff; color:white;">Send</button>
  </div>
</div>

<script>
const chat=document.getElementById('chat');

// Add message to chat
function addMessage(text, cls, thinking=null){
  const bubble=document.createElement('div');
  bubble.className='bubble '+cls;
  bubble.innerHTML=text;
  if(thinking){ bubble.title="Click to see AI thinking"; bubble.onclick=()=>alert(thinking); }
  chat.appendChild(bubble);
  chat.scrollTop=chat.scrollHeight;
}

// Typing effect
async function typeText(bubble,text,delay=15){
  bubble.innerHTML='';
  for(let i=0;i<text.length;i++){
    bubble.innerHTML+=text[i];
    await new Promise(r=>setTimeout(r,delay));
    chat.scrollTop=chat.scrollHeight;
  }
}

// Source fetchers
async function fetchDuck(query, log){
  log.push("DuckDuckGo: fetching...");
  try{
    const res=await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1`);
    const data=await res.json();
    log.push("DuckDuckGo: success");
    if(data.AbstractText) return data.AbstractText;
    else if(data.RelatedTopics && data.RelatedTopics.length>0) return data.RelatedTopics[0].Text.split('\n').slice(0,2).join(' ');
    return "";
  }catch(e){ log.push("DuckDuckGo exception: "+e); return ""; }
}

async function fetchJoke(log){
  log.push("Joke API fetching...");
  try{
    const res=await fetch('https://official-joke-api.appspot.com/random_joke');
    if(res.ok){ const data=await res.json(); log.push("Joke fetched"); return data.setup+" ... "+data.punchline; }
    return "";
  }catch(e){ log.push("Joke exception: "+e); return ""; }
}

async function fetchWeather(query, log){
  log.push("Weather fetching...");
  try{
    const apiKey="YOUR_OPENWEATHER_KEY"; // Replace with your OpenWeatherMap API key
    const city = query.match(/in ([a-zA-Z\s]+)/i)?.[1] || "New York";
    const res=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}`);
    if(res.ok){ const data=await res.json(); log.push("Weather fetched"); return `Weather in ${data.name}: ${data.weather[0].description}, Temp: ${data.main.temp}Â°C`; }
    return "";
  }catch(e){ log.push("Weather exception: "+e); return ""; }
}

// Select sources
function selectSources(msg){
  const sources=[];
  const lower=msg.toLowerCase();
  if(lower.includes("weather")) sources.push("weather");
  if(lower.includes("joke")) sources.push("joke");
  sources.push("duck");
  return sources;
}

// Send message
async function sendMessage(){
  const input=document.getElementById('message');
  const msg=input.value.trim();
  if(!msg) return;
  addMessage(msg,'user');
  input.value='';

  const thinkingBubble=document.createElement('div');
  thinkingBubble.className='bubble bot typing';
  thinkingBubble.textContent='Thinking...';
  chat.appendChild(thinkingBubble);

  const log=[];
  let finalText="";
  const sources=selectSources(msg);
  const promises=[];

  for(const s of sources){
    if(s==="duck") promises.push(fetchDuck(msg,log));
    if(s==="joke") promises.push(fetchJoke(log));
    if(s==="weather") promises.push(fetchWeather(msg,log));
  }

  const results=await Promise.all(promises);

  results.forEach((res,i)=>{
    if(!res) return;
    const s=sources[i];
    if(s==="duck") finalText+="Info:\n"+res+"\n\n";
    if(s==="joke") finalText+="Joke:\n"+res+"\n\n";
    if(s==="weather") finalText+="Weather:\n"+res+"\n\n";
  });

  if(!finalText) finalText="I could not find relevant online info.";

  thinkingBubble.remove();
  const botBubble=document.createElement('div');
  botBubble.className='bubble bot';
  chat.appendChild(botBubble);
  await typeText(botBubble,finalText,15);
  botBubble.onclick=()=>alert(log.join("\n"));
}

// Enter key
document.getElementById('message').addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });
</script>
</body>
</html>
