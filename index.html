<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoonAI</title>
<style>
body { font-family: system-ui, sans-serif; background: #f0f4f8; margin: 20px; }
.container { max-width: 900px; margin: auto; display: flex; flex-direction: column; gap: 12px; }
h2 { text-align: center; color: #111; }
#chat { border:1px solid #ddd; padding:15px; height:600px; overflow-y:auto; background:#fff; border-radius:12px; display:flex; flex-direction:column; gap:8px; }
.bubble { max-width:80%; padding:10px 14px; border-radius:14px; cursor:pointer; white-space: pre-wrap; }
.user { align-self:flex-end; background:#007bff; color:#fff; }
.bot { align-self:flex-start; background:#e5e5ea; color:#111; }
.typing { font-style: italic; color: #666; }
.blink { animation: blink 1s steps(2, start) infinite; }
@keyframes blink { to { visibility: hidden; } }
</style>
</head>
<body>
<div class="container">
<h2>MoonAI - Smart AI</h2>
<div id="chat"></div>
<div style="display:flex; gap:8px;">
<input id="message" placeholder="Ask me anything..." autocomplete="off" style="flex:1; padding:10px; border-radius:8px; border:1px solid #ccc;">
<button onclick="sendMessage()" style="padding:10px 20px; border:none; border-radius:8px; background:#007bff; color:white;">Send</button>
</div>
</div>

<script>
const chat=document.getElementById('chat');

function addMessage(text, cls, thinking=null){
  const bubble=document.createElement('div');
  bubble.className='bubble '+cls;
  bubble.innerHTML=text;
  if(thinking){ bubble.title="Click to see AI thinking"; bubble.onclick=()=>alert(thinking); }
  chat.appendChild(bubble);
  chat.scrollTop=chat.scrollHeight;
}

async function typeText(bubble,text,delay=15){
  bubble.innerHTML='';
  for(let i=0;i<text.length;i++){
    bubble.innerHTML+=text[i];
    await new Promise(r=>setTimeout(r,delay));
    chat.scrollTop=chat.scrollHeight;
  }
}

async function sendMessage(){
  const input=document.getElementById('message');
  const msg=input.value.trim();
  if(!msg) return;
  addMessage(msg,'user');
  input.value='';

  const thinkingBubble=document.createElement('div');
  thinkingBubble.className='bubble bot typing';
  thinkingBubble.textContent='Thinking...';
  chat.appendChild(thinkingBubble);

  try{
    const res=await fetch("/api/moonai",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg})
    });
    const data=await res.json();
    thinkingBubble.remove();
    const botBubble=document.createElement('div');
    botBubble.className='bubble bot';
    chat.appendChild(botBubble);
    await typeText(botBubble,data.answer,15);
    botBubble.onclick=()=>alert(data.log.join("\n"));
  }catch(e){
    thinkingBubble.remove();
    addMessage("Error contacting MoonAI: "+e,'bot');
  }
}

document.getElementById('message').addEventListener('keypress', e=>{
  if(e.key==='Enter') sendMessage();
});
</script>
</body>
</html>
